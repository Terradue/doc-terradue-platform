<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: opensearchSlurper.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: opensearchSlurper.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>


/** String function analogue to java format
 * 
 * Usage example: "Hello, my name is {0} {1}".format("ciccio","ceras") 
 */
if (!String.prototype.format)
	String.prototype.format = function() {
		var args = arguments;
		return this.replace(/{(\d+)}/g, function(match, number) { 
			return typeof args[number] != 'undefined' ? args[number] : match;
		});
	};


OpensearchSlurper = {};

/**
 * Parse an opensearch description document to create an OpensearchSlurper object.
 * @param {string} url - The opensearch description document ur;.
 * @param {function} handler - The function called when the Opensearch object is created ( handler(os) )
 */
OpensearchSlurper.parse = function(url, handler, fail, $os) {
	
	// works on all browsers
	function getMapKeys(map){
		var keys = [];
		for (key in map) {
			keys.push(key)
		};
		return keys;
	}
	
	function getTemplateParameters(template) {
		var params = {};
		template.replace(/{(\w*):?(\w*)(\??)}/g, function(match, value, value2, value3){
			var withNs = (value2!=""),
				name = (withNs ? value2 : value),
				ns = (withNs ? value : null),
				isMandatory = (value3=="");
				completeName = (withNs ? ns+":" : "") + name;				
			
			params[completeName] = {
				name: name,
				ns: ns,
				completeName: completeName,
				isMandatory: isMandatory
			};
			
			//console.log("ns="+ns+", name="+name, isMandatory);
			//return "["+ns+":"+name+"]";
		});
		return params;
	}
	
	// read the opensearch descriptor url
	if ($os==null){
		$.get(url, function(osDescribe){
			$os = $(osDescribe);
			OpensearchSlurper.parse(url, handler, fail, $os);
		});
		return;
	}
	
	// init
	var ris = {
		$osDocument: $os, // the document
		images: [], $images: [],
		urls: {}, templates: [],
	};
	
	// get the os document description info
	$.each(["ShortName","LongName","Description","Tags","Contact","Developer","Attribution","SyndicationRight","AdultContent","Language","OutputEncoding","InputEncoding"], function(){
		ris[""+this] = $os.find(""+this).text();
	});
	
	// create tags array
	ris.tagsArray = $os.find("Tags").text().split(" ");
	
	// queries
	ris.queries = {};
	$os.find("Query").each(function(){
		var $query = $(this),
			role = $query.attr("role");
		if (role!=null)
			ris.queries[role] = {
				role: role,
				searchTerms: $query.attr("searchTerms"),
				startPage: $query.attr("startPage"),
				totalResults: $query.attr("totalResults"),
				title: $query.attr("title"),
			};
	});
	
	// images
	$os.find("Image").each(function(){
		var image = {
			height: $(this).attr("height"),
			width: $(this).attr("width"),
			type: $(this).attr("type"),
			url: $(this).text(),
		};
		image.$img = $("&lt;img>").attr("height",image.height).attr("width",image.width).attr("type",image.type).attr("src",image.url);
		ris.images.push(image);
		ris.$images.push(image.$img);
	});
	
	// url and templates
	$os.find("Url").each(function(){
		console.log("Url", this);
		var $url = $(this),
			type = $url.attr("type"),
			url = {
				type: type,
				template: $url.attr("template"),
				rel: $url.attr("rel"),
				indexOffset: $url.attr("indexOffset"),
				pageOffset: $url.attr("pageOffset"),
			};
		url.params = getTemplateParameters(url.template);
		
		url.getUrlInstance = function(data){
			if (data==null) data = {};
			return url.template.replace(/{([\w:]+)(\??)}/g, function(match, completeName, value2){
				var isMandatory = (value2!="?");
				return data[completeName] == null ? "" : data[completeName];
			});
		};
		url.getParamNames = function(){
			return getMapKeys(url.params);
		}
		
		ris.urls[type] = url;
	});
	
	ris.getUrlTypes = function(){
		return getMapKeys(ris.urls);
	}
	
	handler(ris);
	
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-dev</a> on Tue Oct 29 2013 15:12:06 GMT+0100 (CET)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
